($=>{wp.customize.bind("ready",function(){var iframe_url,get_preview_url=woocommerce_email_customizer_controls_local.previewUrl,email_trigger=woocommerce_email_customizer_controls_local.email_trigger;wp.customize.panel(woocommerce_email_customizer_controls_local.panel_id).expanded.bind(function(isExpanded){var iframe=document.querySelector('iframe[title="Site Preview"]');if(!iframe)throw new Error("Preview iframe not found");var baseUrl=iframe.getAttribute("data-src")||iframe.src;if(!baseUrl)throw new Error("Invalid iframe source");baseUrl=new URL(baseUrl);iframe_url=baseUrl.toString(),console.log(get_preview_url),isExpanded?(wp.customize.previewer.previewUrl.set(get_preview_url),iframe.src=get_preview_url,iframe.setAttribute("data-src",get_preview_url)):(wp.customize.previewer.previewUrl.set(iframe_url),iframe.src=iframe_url,iframe.setAttribute("data-src",iframe_url))}),wp.customize("wc_email_templates",function(value){value.bind(function(newVal){-1!==wp.customize.previewer.previewUrl().indexOf(email_trigger)&&wp.customize.previewer.refresh()})}),wp.customize("wc_email_text",function(value){value.bind(function(newVal){-1!==wp.customize.previewer.previewUrl().indexOf(email_trigger)&&wp.customize.previewer.refresh()})}),wp.customize("wc_email_header",function(value){value.bind(function(newVal){-1!==wp.customize.previewer.previewUrl().indexOf(email_trigger)&&wp.customize.previewer.refresh()})}),wp.customize("wc_email_appearance_customizer",function(value){value.bind(function(newVal){-1!==wp.customize.previewer.previewUrl().indexOf(email_trigger)&&wp.customize.previewer.refresh()})}),wp.customize("wc_email_body",function(value){value.bind(function(newVal){-1!==wp.customize.previewer.previewUrl().indexOf(email_trigger)&&wp.customize.previewer.refresh()})}),wp.customize("wc_email_footer",function(value){value.bind(function(newVal){-1!==wp.customize.previewer.previewUrl().indexOf(email_trigger)&&wp.customize.previewer.refresh()})}),wp.customize.section("wc_email_templates",function(section){section.expanded.bind(function(isExpanded){isExpanded?($("#customize-save-button-wrapper").hide(),$(document).on("click",".wb-email-customizer-save-btn",function(e){e.preventDefault();var $button=$(this),$status=$(".wb-save-status"),customizerData=($button.prop("disabled",!0),$button.text(woocommerce_email_customizer_controls_local.saving_text),$status.hide(),{});wp.customize.each(function(setting){var settingId=setting.id;0!==settingId.indexOf("woocommerce_email_")&&"email_customizer_reset_btn"!==settingId||(customizerData[settingId]=setting.get())}),$.ajax({url:woocommerce_email_customizer_controls_local.ajaxurl,type:"POST",data:{action:"wb_email_customizer_save",nonce:woocommerce_email_customizer_controls_local.ajaxSendEmailNonce,customizer_data:JSON.stringify(customizerData)},success:function(response){response.success?($status.removeClass("error").addClass("success").text(woocommerce_email_customizer_controls_local.saved_text).show().fadeOut(3e3),wp.customize.each(function(setting){0===setting.id.indexOf("woocommerce_email_")&&(setting._dirty=!1)}),$(document).trigger("wb-email-customizer-saved",[customizerData])):$status.removeClass("success").addClass("error").text(woocommerce_email_customizer_controls_local.error_text).show()},error:function(){$status.removeClass("success").addClass("error").text(woocommerce_email_customizer_controls_local.error_text).show()},complete:function(){$button.prop("disabled",!1),$button.text($button.data("original-text")||"Save Email Settings")}})}),$(".wb-email-customizer-save-btn").each(function(){$(this).data("original-text",$(this).text())})):$("#customize-save-button-wrapper").show()})}),wp.customize("woocommerce_email_template",function(setting){setting.bind(function(value){var templateControls;value=value,templateControls={default:{show:["wc_email_rounded_corners_control","wc_email_box_shadow_spread_control"],hide:[]},"template-one":{show:[""],hide:["wc_email_rounded_corners_control"]},"template-two":{show:[""],hide:["wc_email_rounded_corners_control","wc_email_box_shadow_spread_control"]},"template-three":{show:[""],hide:["wc_email_rounded_corners_control","wc_email_box_shadow_spread_control"]}},$(".customize-control").show(),templateControls[value]&&templateControls[value].hide&&templateControls[value].hide.forEach(function(controlId){wp.customize.control(controlId).deactivate()})})}),wp.customize("woocommerce_email_header_image_placement",function(setting){setting.bind(function(value){""===value?(wp.customize.control("wc_email_header_image_control").deactivate(),wp.customize.control("wc_email_header_image_alignment_control").deactivate()):(wp.customize.control("wc_email_header_image_control").activate(),wp.customize.control("wc_email_header_image_alignment_control").activate())})}),$(".customize-control").on("click",".reset-to-default",function(e){e.preventDefault();var defaultValue,e=$(this).closest(".customize-control").attr("id").replace("customize-control-","");wp.customize.has(e)&&(defaultValue=(e=wp.customize(e))._value,e.set(defaultValue))})}),wp.customize.bind("ready",function(){wp.customize.section("wc_email_header",function(section){section.expanded.bind(function(isExpanded){function toggleHeaderImageControls(value){var control1,control2;wp.customize.control.has("wc_email_header_image_control")&&(control1=wp.customize.control("wc_email_header_image_control"),control2=wp.customize.control("wc_email_header_image_alignment_control"),value?(control1.container.show(),control2.container.show()):(control1.container.hide(),control2.container.hide()))}isExpanded&&(wp.customize.has("woocommerce_email_header_image_placement")?(toggleHeaderImageControls((isExpanded=wp.customize("woocommerce_email_header_image_placement")).get()),isExpanded.bind(toggleHeaderImageControls)):console.warn("woocommerce_email_header_image_placement setting not found"))})}),wp.customize("woocommerce_email_header_image_placement",function(setting){function toggleHeaderImageControls(value){value?(wp.customize.control("wc_email_header_image_control").activate(),wp.customize.control("wc_email_header_image_alignment_control").activate()):(wp.customize.control("wc_email_header_image_control").deactivate(),wp.customize.control("wc_email_header_image_alignment_control").deactivate())}toggleHeaderImageControls(setting.get()),setting.bind(toggleHeaderImageControls)})}),wp.customize.bind("saved",function(){wp.customize.each(function(setting){0===setting.id.indexOf("woocommerce_email_")&&(setting._dirty=!1)})}),$(document).on("keydown",function(e){e.ctrlKey&&83===e.which&&wp.customize.section.each(function(section){if(section.expanded()&&(section=section.id,-1!==["wc_email_templates","wc_email_text","wc_email_appearance_customizer","wc_email_header","wc_email_body","wc_email_footer"].indexOf(section)))return e.preventDefault(),$(".wb-email-customizer-save-btn").trigger("click"),!1})})})(jQuery);